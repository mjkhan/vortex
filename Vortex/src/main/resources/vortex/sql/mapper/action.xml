<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="action">

<resultMap id="actionRow" type="action">
	<id property="id" column="ACT_ID"/>
	<result property="groupID" column="GRP_ID"/>
	<result property="name" column="ACT_NAME"/>
	<result property="path" column="ACT_PATH"/>
	<result property="description" column="DESCRP"/>
	<result property="modifiedBy" column="UPD_ID"/>
	<result property="lastModified" column="UPD_TIME"/>
</resultMap>
	
<!-- 그룹별 액션 목록 가져오기 -->
<select id="getActions" parameterType="string" resultType="dataobject">
SELECT * FROM TBL_ACTION
WHERE GRP_ID = #{groupID}
ORDER BY ACT_ID
</select>
	
<!-- 액션 가져오기 -->
<select id="getAction" parameterType="string" resultMap="actionRow">
SELECT *
FROM TBL_ACTION
WHERE ACT_ID = #{actionID}
</select>
	
<!-- 액션 찾기 -->
<select id="findAction" parameterType="string" resultMap="actionRow">
SELECT *
FROM TBL_ACTION
WHERE ACT_PATH = #{actionPath}
</select>

<!-- 액션 정보 생성 -->
<insert id="insert" parameterType="action">
<selectKey keyProperty="id" order="BEFORE">
SELECT LPAD(IFNULL((CAST(MAX(ACT_ID) AS UNSIGNED) + 1), 1), 5, '0') NEW_ID
FROM TBL_ACTION;
</selectKey>
INSERT INTO TBL_ACTION (
	ACT_ID,
	GRP_ID,
	ACT_NAME,
	ACT_PATH,
	DESCRP,
	UPD_ID,
	UPD_TIME
) VALUES (
	#{id},
	#{groupID},
	#{name},
	#{path},
	#{description},
	#{modifiedBy},
	CURRENT_TIMESTAMP
)
</insert>

<!-- 액션 정보 수정 -->
<update id="update" parameterType="action">
UPDATE TBL_ACTION SET
	ACT_NAME = #{name},
	ACT_PATH = #{path},
	DESCRP = #{description},
	UPD_ID = #{modifiedBy},
	UPD_TIME = CURRENT_TIMESTAMP
WHERE ACT_ID = #{id}
</update>

<!-- groupID의 액션 정보를 삭제 -->
<delete id="delete" parameterType="hashmap">
DELETE FROM TBL_ACTION
<if test="groupID != null">WHERE GRP_ID = #{groupID}</if>
<if test="actionIDs != null">
	<if test="groupID != null">AND </if>
	<if test="groupID == null">WHERE </if>
	ACT_ID IN (<foreach collection="actionIDs" item="actionID" separator=", ">#{actionID}</foreach>)
</if>
</delete>

</mapper>