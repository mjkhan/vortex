<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="roleAction">

<!-- roleIDs의 역할에 actionIDs의 액션 추가 -->
<insert id="insert" parameterType="hashmap">
INSERT INTO TBL_ROLE_ACTION (ROLE_ID, ACT_ID, INS_ID, INS_TIME)
SELECT ROLE_ID, ACT_ID, #{addedBy}, CURRENT_TIMESTAMP
FROM (
	<foreach collection="roleIDs" item="roleID" separator=" UNION">SELECT #{roleID} ROLE_ID</foreach>
) A, (
	<foreach collection="actionIDs" item="actionID" separator=" UNION">SELECT #{actionID} ACT_ID</foreach>
) B
WHERE NOT EXISTS (
	SELECT ROLE_ID, ACT_ID
	FROM TBL_ROLE_ACTION C
	WHERE C.ROLE_ID = A.ROLE_ID
	AND C.ACT_ID = B.ACT_ID
)
</insert>

<!-- roleIDs의 역할에서 actionIDs의 액션 삭제 -->
<delete id="delete" parameterType="hashmap">
DELETE FROM TBL_ROLE_ACTION
<if test="roleIDs != null">
WHERE ROLE_ID IN (<foreach collection="roleIDs" item="roleID" separator=", ">#{roleID}</foreach>)
</if>
<if test="actionIDs != null">
	<if test="roleIDs != null">AND</if>
	<if test="roleIDs == null">WHERE</if>
	ACT_ID IN (<foreach collection="actionIDs" item="actionID" separator=", ">#{actionID}</foreach>)
</if>
</delete>

</mapper>